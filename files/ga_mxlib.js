var UAMxCore=new MxClass({options:{mx_version:"1.4"},initialize:function(t){this.setOptions(t)},namespace:function(){var t,n,e,i,o,r=arguments,s=null;for(i=r.length,t=0;i>t;t+=1)for(e=(""+r[t]).split("."),s=this,o=e.length,n=0;o>n;n+=1)s[e[n]]=s[e[n]]||{},s=s[e[n]];return s},exec:function(t){t.call(this)},show_version:function(){alert("ga_mxlib version:"+this.options.mx_version)}});UAMxCore.mx_implement(new MxOptions),UAMX=new UAMxCore,UAMX.ReqBase=new MxClass({options:{targetTag:[{tag:"a",event:"click"}],waitingCount:100},initialize:function(t){this.setOptions(t)},prepareEvent:function(){if(this.options.targetTag){var t,n,e,i,o,r,s,a;for(n=this.options.targetTag.length,t=0;n>t;t++)for(e=this.options.targetTag[t].tag,a=this.options.targetTag[t].event,r=document.mx_getElements(e),i=r.length,e=0;i>e;e++)o=r[e],this.getUrl(o),(s=this.checkExec(o))&&(s=this.checkIgnorJumpUrl(o),o.mx_addEvent(a,function(t,n,e){var i=this.storeData(n);e?t.preventDefault():(1==i.prevent&&t.preventDefault(),1==i.waiting&&this.jumpUrl.mx_delay(this.options.waitingCount,this,n))}.mx_bindWithEvent(this,[o,s])))}},jumpUrl:function(t){var n=this.getUrl(t);(t=t.mx_getProperty("target"))?window.open(n,t):document.location=n},checkExec:function(t){t=this.getUrl(t);var n,e,i,o,r=!0;if(this.options.IncludeCondition)for(r=!1,e=this.options.IncludeCondition.length,n=0;e>n;n++){i=this.options.IncludeCondition[n];try{if(o=RegExp(i,"i"),o.test(t)){r=!0;break}}catch(s){alert("MxParams.json error:IncludeCondition:"+i)}}if(!r)return r;if(this.options.ExcludeCondition)for(e=this.options.ExcludeCondition.length,n=0;e>n;n++){i=this.options.ExcludeCondition[n];try{if(o=RegExp(i,"i"),o.test(t)){r=!1;break}}catch(a){alert("MxParams.json error:ExcludeCondition:"+i)}}return r},getUrl:function(t){var n=t.mx_getTag(),e=null;return"a"==n?e=t.mx_getProperty("href"):"form"==n&&(e=t.mx_getProperty("action")),e},storeData:function(){return{prevent:!1,waiting:!1}},storeDataPageView:function(t){ga&&(t=this.getUrl(t),ga("send","pageview",t))},storeDataEvent:function(t){if(ga){t=this.getUrl(t);var n,e,i,o;if(this.options.EventCondition){var r,s,a,u,p,h,g=this.options.EventCondition.Default;g&&(u=g.category,p=g.action,h=g.opt_value);var c=!1,l=this.options.EventCondition.ConditionList;if(l)for(e=l.length,n=0;e>n;n++)if(i=l[n],o=i.condition)try{RegExp(o,"i").test(t)&&(r=i.category,s=i.action,(a=i.opt_value)||0==a?ga("send","event",r,s,t,h):ga("send","event",r,s,t),c=!0)}catch(m){alert("MxParams.json error:EventCondition:"+o)}0==c&&g&&(h||0==h?ga("send","event",u,p,t,h):ga("send","event",u,p,t))}}},checkIgnorJumpUrl:function(t){if(!this.options.IgnoreJumpUrl)return!1;var n=this.options.IgnoreJumpUrl.Condition;if(!n)return!1;var e,i,o,r;for(i=n.length,e=0;i>e;e++)if(o=n[e],r=o.Include,o=o.Exclude,r=this.checkIgnoreElement(t,r,o))return r;return!1},checkIgnoreElement:function(t,n,e){if(!n||0==n.length)return!1;var i,o,r,s;for(o=n.length,s=!1,i=0;o>i;i++)if(r=n[i],r=document.mx_getElements(r),r=this.checkTarget(t,r)){s=!0;break}if(!s)return!1;if(!e)return!0;for(o=e.length,s=!1,i=0;o>i;i++)if(r=e[i],r=document.mx_getElements(r),r=this.checkTarget(t,r)){s=!0;break}return s?!1:!0},checkTarget:function(t,n){if(!n)return!1;var e,i,o;for(i=n.length,e=0;i>e;e++)if(o=n[e],o==t)return!0;return!1}}),UAMX.ReqBase.mx_implement(new MxOptions),UAMX.UAReqCustomVar=UAMX.ReqBase.mx_extend({options:{optionsKey:"CustomVarOptions"},initialize:function(t){t&&t[this.options.optionsKey]&&(this.parent(t[this.options.optionsKey]),this.customVarIndexList=[],this.setCustomVar())},getCustomVarIndexList:function(){return this.customVarIndexList},setCustomVar:function(){var t=document.location.toString(),n=this.options.ConditionList;if(n){var e,i,o,r,s,a,u;for(i=n.length,e=0;i>e;e++)s=n[e],o=s.condition,a=s.index,r=s.name,u=s.value,s=s.opt_scope,o=RegExp(o,"i"),o.test(t)&&r&&r.length>0&&ga("set","dimension1",u)}}}),UAMX.UAReqCustomVarDriver=new MxClass({initialize:function(t){this.execCustomVar(t)},execCustomVar:function(t){if(t){var n=new UAMX.UAReqCustomVar(t).getCustomVarIndexList();t.customVarIndexList=n}}}),UAMX.UAReqDownload=UAMX.ReqBase.mx_extend({options:{optionsKey:"DownloadOptions",targetTag:[{tag:"a",event:"click"}]},initialize:function(t){t&&t[this.options.optionsKey]&&(this.parent(t[this.options.optionsKey]),t.waitingCount&&(this.options.waitingCount=t.waitingCount),t.IgnoreJumpUrl&&t.IgnoreJumpUrl.active&&(this.options.IgnoreJumpUrl=t.IgnoreJumpUrl),this.prepareEvent())},storeData:function(t){if(!this.options.PutMethod)return{prevent:!1,waiting:!1};var n;n=this.options.PutMethod;var e,i,o;for(i=n.length,e=0;i>e;e++)o=n[e],"pageview"==o?this.storeDataPageView(t):"event"==o&&this.storeDataEvent(t);return t=t.mx_getProperty("target"),t&&"_self"!=t?{prevent:!1,waiting:!1}:{prevent:!0,waiting:!0}}}),UAMX.UAReqExternalSite=UAMX.ReqBase.mx_extend({options:{optionsKey:"ExternalSiteOptions",targetTag:[{tag:"a",event:"click"},{tag:"form",event:"submit"}]},initialize:function(t){t&&t[this.options.optionsKey]&&(this.parent(t[this.options.optionsKey]),t.waitingCount&&(this.options.waitingCount=t.waitingCount),t.IgnoreJumpUrl&&t.IgnoreJumpUrl.active&&(this.options.IgnoreJumpUrl=t.IgnoreJumpUrl),this.domain=null,this.setup(),this.prepareEvent())},setup:function(){var t=document.location.toString().match(/^https?:\/\/([\w.\-:]+)\/?/);null!=t&&(this.domain=t[1])},storeData:function(t){if(!this.options.PutMethod)return{prevent:!1,waiting:!1};var n;n=this.options.PutMethod;var e,i,o;for(i=n.length,e=0;i>e;e++)o=n[e],"pageview"==o?this.storeDataPageView(t):"event"==o&&this.storeDataEvent(t);return t=t.mx_getProperty("target"),t&&"_self"!=t?{prevent:!1,waiting:!1}:{prevent:!0,waiting:!0}},checkExec:function(t){this.options.IncludeCondition?this.options.IncludeCondition.push("^https?://"):this.options.IncludeCondition=["^https?://"];var n=this.getUrl(t);return 0==this.parent(t)?!1:(n=this.getUrl(t),(t=n.match(/^https?:\/\/([\w.\-:]+)\/?/))&&null!=this.domain&&t[1]==this.domain?!1:!0)}});var ua=window.navigator.userAgent.toLowerCase();ua.match(/starbucksjapan/)||window.mx_addEvent("domready",function(){UAMX.exec(function(){new UAMX.UAReqDownload(UAParams),new UAMX.UAReqExternalSite(UAParams)})});
